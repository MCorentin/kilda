name: KILDA apptainer deploy

on:
  push:
    branches: [ "dev" ]
  pull_request:
    branches: [ "dev" ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup apptainer
      uses: eWaterCycle/setup-apptainer@v2.0.0

    - name: Build KILDA image with apptainer
      run: |
        apptainer build kiv2_20240530_0.2.sif kiv2_20240530.def
        apptainer push kiv2_20240530_0.2.sif oras://ghcr.io/${GITHUB_REPOSITORY}/kiv2_20240530_0.2.sif:latest